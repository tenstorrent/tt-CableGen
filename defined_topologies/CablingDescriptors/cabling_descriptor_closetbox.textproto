graph_templates {
  key: "n300_lb_mesh"
  value {
    children {
      name: "n300_lb"
      node_ref { node_descriptor: "N300_LB" }
    }
    internal_connections {
      key: "QSFP_DD"
        value {
        connections {
          port_a { path: ["n300_lb"] tray_id: 1 port_id: 1 }
          port_b { path: ["n300_lb"] tray_id: 4 port_id: 1 }
        }
        connections {
          port_a { path: ["n300_lb"] tray_id: 2 port_id: 2 }
          port_b { path: ["n300_lb"] tray_id: 3 port_id: 2 }
        }
      }
    }
  }
}

graph_templates {
  key: "n300_lb_pod"
  value {
    children {
      name: "mesh_1"
      graph_ref { graph_template: "n300_lb_mesh" }
    }
    children {
      name: "mesh_2"
      graph_ref { graph_template: "n300_lb_mesh" }
    }
    children {
      name: "mesh_3"
      graph_ref { graph_template: "n300_lb_mesh" }
    }
    children {
      name: "mesh_4"
      graph_ref { graph_template: "n300_lb_mesh" }
    }
    # Internal superpod connections
    internal_connections {
      key: "QSFP_DD"
      value {
        connections {
          port_a { path: ["mesh_1", "n300_lb"] tray_id: 1 port_id: 2 }
          port_b { path: ["mesh_4", "n300_lb"] tray_id: 1 port_id: 2 }
        }
        connections {
          port_a { path: ["mesh_1", "n300_lb"] tray_id: 3 port_id: 1 }
          port_b { path: ["mesh_2", "n300_lb"] tray_id: 3 port_id: 1 }
        }
        connections {
          port_a { path: ["mesh_1", "n300_lb"] tray_id: 4 port_id: 2 }
          port_b { path: ["mesh_3", "n300_lb"] tray_id: 4 port_id: 2 }
        }
        connections {
          port_a { path: ["mesh_2", "n300_lb"] tray_id: 2 port_id: 1 }
          port_b { path: ["mesh_3", "n300_lb"] tray_id: 2 port_id: 1 }
        }
        connections {
          port_a { path: ["mesh_2", "n300_lb"] tray_id: 4 port_id: 2 }
          port_b { path: ["mesh_4", "n300_lb"] tray_id: 2 port_id: 1 }
        }
        connections {
          port_a { path: ["mesh_3", "n300_lb"] tray_id: 3 port_id: 1 }
          port_b { path: ["mesh_4", "n300_lb"] tray_id: 3 port_id: 1 }
        }
      }
    }
  }
}

# Cluster template (4 pods)
graph_templates {
  key: "n300_lb_superpod"
  value {
    children {
      name: "pod_1"
      graph_ref { graph_template: "n300_lb_pod" }
    }
    children {
      name: "pod_2"
      graph_ref { graph_template: "n300_lb_pod" }
    }
    children {
      name: "pod_3"
      graph_ref { graph_template: "n300_lb_pod" }
    }
    children {
      name: "pod_4"
      graph_ref { graph_template: "n300_lb_pod" }
    }
    # Inter-pod connections
    internal_connections {
      key: "QSFP_DD"
      value {
        connections {
          port_a { path: ["pod_1", "mesh_1", "n300_lb"] tray_id: 2 port_id: 1 }
          port_b { path: ["pod_3", "mesh_1", "n300_lb"] tray_id: 2 port_id: 1 }
        }
        connections {
          port_a { path: ["pod_1", "mesh_3", "n300_lb"] tray_id: 1 port_id: 2 }
          port_b { path: ["pod_2", "mesh_2", "n300_lb"] tray_id: 1 port_id: 2 }
        }
        connections {
          port_a { path: ["pod_1", "mesh_4", "n300_lb"] tray_id: 4 port_id: 2 }
          port_b { path: ["pod_4", "mesh_1", "n300_lb"] tray_id: 2 port_id: 1 }
        }
        connections {
          port_a { path: ["pod_3", "mesh_3", "n300_lb"] tray_id: 1 port_id: 2 }
          port_b { path: ["pod_4", "mesh_2", "n300_lb"] tray_id: 1 port_id: 2 }
        }
        connections {
          port_a { path: ["pod_3", "mesh_4", "n300_lb"] tray_id: 4 port_id: 2 }
          port_b { path: ["pod_2", "mesh_1", "n300_lb"] tray_id: 2 port_id: 1 }
        }
        connections {
          port_a { path: ["pod_2", "mesh_4", "n300_lb"] tray_id: 4 port_id: 2 }
          port_b { path: ["pod_4", "mesh_4", "n300_lb"] tray_id: 4 port_id: 2 }
        }
      }
    }
  }
}

# Root instance with concrete host mappings (4 pods)
root_instance {
  template_name: "n300_lb_superpod"
  child_mappings {
    key: "pod_1"
    value {
      sub_instance {
        template_name: "n300_lb_pod"

        child_mappings {
          key: "mesh_1"
          value {
            sub_instance {
              template_name: "n300_lb_mesh"
              child_mappings {
                key: "n300_lb"
                value { host_id: 0 }
              }
            }
          }
        }
        child_mappings {
          key: "mesh_2"
          value {
            sub_instance {
              template_name: "n300_lb_mesh"
              child_mappings {
                key: "n300_lb"
                value { host_id: 1 }
              }
            }
          }
        }
        child_mappings {
          key: "mesh_3"
          value {
            sub_instance {
              template_name: "n300_lb_mesh"
              child_mappings {
                key: "n300_lb"
                value { host_id: 2 }
              }
            }
          }
        }
        child_mappings {
          key: "mesh_4"
          value {
            sub_instance {
              template_name: "n300_lb_mesh"
              child_mappings {
                key: "n300_lb"
                value { host_id: 3 }
              }
            }
          }
        }
      }
    }
  }
  child_mappings {
    key: "pod_2"
    value {
      sub_instance {
        template_name: "n300_lb_pod"

        child_mappings {
          key: "mesh_1"
          value {
            sub_instance {
              template_name: "n300_lb_mesh"
              child_mappings {
                key: "n300_lb"
                value { host_id: 4 }
              }
            }
          }
        }
        child_mappings {
          key: "mesh_2"
          value {
            sub_instance {
              template_name: "n300_lb_mesh"
              child_mappings {
                key: "n300_lb"
                value { host_id: 5 }
              }
            }
          }
        }
        child_mappings {
          key: "mesh_3"
          value {
            sub_instance {
              template_name: "n300_lb_mesh"
              child_mappings {
                key: "n300_lb"
                value { host_id: 6 }
              }
            }
          }
        }
        child_mappings {
          key: "mesh_4"
          value {
            sub_instance {
              template_name: "n300_lb_mesh"
              child_mappings {
                key: "n300_lb"
                value { host_id: 7 }
              }
            }
          }
        }
      }
    }
  }
  child_mappings {
    key: "pod_3"
    value {
      sub_instance {
        template_name: "n300_lb_pod"
        child_mappings {
          key: "mesh_1"
          value {
            sub_instance {
              template_name: "n300_lb_mesh"
              child_mappings {
                key: "n300_lb"
                value { host_id: 8 }
              }
            }
          }
        }
        child_mappings {
          key: "mesh_2"
            value {
            sub_instance {
              template_name: "n300_lb_mesh"
              child_mappings {
                key: "n300_lb"
                value { host_id: 9 }
              }
            }
          }
        }
        child_mappings {
          key: "mesh_3"
          value {
            sub_instance {
              template_name: "n300_lb_mesh"
              child_mappings {
                key: "n300_lb"
                value { host_id: 10 }
              }
            }
          }
        }
        child_mappings {
          key: "mesh_4"
          value {
            sub_instance {
              template_name: "n300_lb_mesh"
              child_mappings {
                key: "n300_lb"
                value { host_id: 11 }
              }
            }
          }
        }
      }
    }
  }
  child_mappings {
    key: "pod_4"
    value {
      sub_instance {
        template_name: "n300_lb_pod"

        child_mappings {
          key: "mesh_1"
          value {
            sub_instance {
              template_name: "n300_lb_mesh"
              child_mappings {
                key: "n300_lb"
                value { host_id: 12 }
              }
            }
          }
        }
        child_mappings {
          key: "mesh_2"
          value {
            sub_instance {
              template_name: "n300_lb_mesh"
              child_mappings {
                key: "n300_lb"
                value { host_id: 13 }
              }
            }
          }
        }
        child_mappings {
          key: "mesh_3"
          value {
            sub_instance {
              template_name: "n300_lb_mesh"
              child_mappings {
                key: "n300_lb"
                value { host_id: 14 }
              }
            }
          }
        }
        child_mappings {
          key: "mesh_4"
          value {
            sub_instance {
              template_name: "n300_lb_mesh"
              child_mappings {
                key: "n300_lb"
                value { host_id: 15 }
              }
            }
          }
        }
      }
    }
  }
}
